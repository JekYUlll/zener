# 更新日志

## 2023-04-10: 添加日志轮转功能

### 新功能

- **日志轮转系统**：增加了日志文件自动轮转功能，当日志文件达到指定大小时，会自动创建新文件并保留历史记录
  - 默认配置：文件大小上限50MB，保留10个历史文件
  - 支持自定义配置文件大小和历史文件数量
  - 线程安全实现，适用于高并发场景

### 修改文件

1. **include/utils/log/use_spd_log.h**
   - 添加 `WriteToFileWithRotation` 方法声明
   - 增加轮转配置相关常量
   - 添加 `_usingRotation` 标志

2. **src/utils/log/use_spd_log.cpp**
   - 实现 `WriteToFileWithRotation` 方法
   - 添加 SPDLog 的 rotating_file_sink 支持
   - 优化文件路径处理逻辑

3. **cmd/server/main.cpp**
   - 更新主函数，使用日志轮转功能
   - 改进日志目录创建逻辑

### 新增文件

1. **scripts/test_log_rotation.sh**
   - 测试脚本，用于验证日志轮转功能
   - 通过发送大量请求生成日志内容
   - 自动检查日志文件数量，验证轮转是否生效

2. **docs/log_rotation.md**
   - 详细文档，说明日志轮转功能的用法
   - 包含代码示例和最佳实践
   - 文件命名规则和技术实现说明

### 文档更新

1. **README.md**
   - 添加日志系统章节，介绍日志轮转功能
   - 更新开发者指南，添加日志相关文件介绍
   - 添加使用示例代码

### 修复问题

无

### 待解决问题

- 考虑增加日志压缩功能，对历史日志文件进行自动压缩
- 添加日志清理策略，根据时间自动清理过期日志文件 